(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(e){var c=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var j=e.Pos;var a={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function d(k){return k&&k.bracketRegex||/[(){}[\]]/}function f(r,o,l){var u=r.getLineHandle(o.line),q=o.ch-1;var n=l&&l.afterCursor;if(n==null){n=/(^| )cm-fat-cursor($| )/.test(r.getWrapperElement().className)}var s=d(l);var p=(!n&&q>=0&&s.test(u.text.charAt(q))&&a[u.text.charAt(q)])||s.test(u.text.charAt(q+1))&&a[u.text.charAt(++q)];if(!p){return null}var m=p.charAt(1)==">"?1:-1;if(l&&l.strict&&(m>0)!=(q==o.ch)){return null}var k=r.getTokenTypeAt(j(o.line,q+1));var t=g(r,j(o.line,q+(m>0?1:0)),m,k,l);if(t==null){return null}return{from:j(o.line,q),to:t&&t.pos,match:t&&t.ch==p.charAt(0),forward:m>0}}function g(x,s,o,l,n){var m=(n&&n.maxScanLineLength)||10000;var u=(n&&n.maxScanLines)||1000;var w=[];var y=d(n);var r=o>0?Math.min(s.line+u,x.lastLine()+1):Math.max(x.firstLine()-1,s.line-u);for(var p=s.line;p!=r;p+=o){var z=x.getLine(p);if(!z){continue}var v=o>0?0:z.length-1,q=o>0?z.length:-1;if(z.length>m){continue}if(p==s.line){v=s.ch-(o<0?1:0)}for(;v!=q;v+=o){var k=z.charAt(v);if(y.test(k)&&(l===undefined||(x.getTokenTypeAt(j(p,v+1))||"")==(l||""))){var t=a[k];if(t&&(t.charAt(1)==">")==(o>0)){w.push(k)}else{if(!w.length){return{pos:j(p,v),ch:k}}else{w.pop()}}}}}return p-o==(o>0?x.lastLine():x.firstLine())?false:null}function b(u,o,n){var l=u.state.matchBrackets.maxHighlightLineLength||1000,t=n&&n.highlightNonMatching;var s=[],m=u.listSelections();for(var p=0;p<m.length;p++){var r=m[p].empty()&&f(u,m[p].head,n);if(r&&(r.match||t!==false)&&u.getLine(r.from.line).length<=l){var k=r.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";s.push(u.markText(r.from,j(r.from.line,r.from.ch+1),{className:k}));if(r.to&&u.getLine(r.to.line).length<=l){s.push(u.markText(r.to,j(r.to.line,r.to.ch+1),{className:k}))}}}if(s.length){if(c&&u.state.focused){u.focus()}var q=function(){u.operation(function(){for(var v=0;v<s.length;v++){s[v].clear()}})};if(o){setTimeout(q,800)}else{return q}}}function i(k){k.operation(function(){if(k.state.matchBrackets.currentlyHighlighted){k.state.matchBrackets.currentlyHighlighted();k.state.matchBrackets.currentlyHighlighted=null}k.state.matchBrackets.currentlyHighlighted=b(k,false,k.state.matchBrackets)})}function h(k){if(k.state.matchBrackets&&k.state.matchBrackets.currentlyHighlighted){k.state.matchBrackets.currentlyHighlighted();k.state.matchBrackets.currentlyHighlighted=null}}e.defineOption("matchBrackets",false,function(k,m,l){if(l&&l!=e.Init){k.off("cursorActivity",i);k.off("focus",i);k.off("blur",h);h(k)}if(m){k.state.matchBrackets=typeof m=="object"?m:{};k.on("cursorActivity",i);k.on("focus",i);k.on("blur",h)}});e.defineExtension("matchBrackets",function(){b(this,true)});e.defineExtension("findMatchingBracket",function(m,l,k){if(k||typeof l=="boolean"){if(!k){l=l?{strict:true}:null}else{k.strict=l;l=k}}return f(this,m,l)});e.defineExtension("scanForBracket",function(n,l,m,k){return g(this,n,l,m,k)})});